<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <style>
        body{

            position: relative;

            background: #F9F9F9;
        }

        #collage{
            position: absolute;
            overflow: hidden;
            width:100%
        }

        #collage > div {
            width: 5%;
            height: 75px;
            background-position: center;
            background-size: contain;
            float: left;
        }

        .court-icon{
            float:left;
            background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/court.svg);
            width:40px;
            height:40px;
        }

        .court-info{
            float: left;
            width:  172px;
        }

        header{
            width:100%;
            background: red;
            position: relative;
            height: 150px;
            margin-bottom: 15px;
        }

        #main-results{
            position: relative;
            width: 600px;
            height: 600px;
            margin-top: 10px;
            margin: auto;
        }

        img{
            width: 180px;
            height: 158px;
            float: left;
            margin-right: 10px;
        }

        .case-description{
            min-height: 52px;
            color: gray;
        }
        .case-pledged{
            float: right;
            color: #1BD218;
            font-size: 14px;
            position: relative;
            font-size: 17px;
        }
        
        .inner-case-result{
            overflow: hidden;
        }
        
        .pledged-amount{
            margin-left: 45px;
            padding-top: 9px;
        }

        .pledged-icon{
            background: url(https://s3-us-west-2.amazonaws.com/social-justice/piggy.png);
            width: 40px;
            height: 40px;
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute;
        }

        .progress{
            margin-bottom: 0;
            margin: 5px 0;
            width: 400px;
            height: 16px;
        }

        .progress-bar{
            background-color: #1BD218;
            line-height: 16px;
        }

        .result{
            margin-bottom: 10px;
            background-color: white;
            border-radius: 4px;
            padding-right: 10px;
            position: relative;
            box-shadow: 6px 6px 5px #888888;
        }
        #screen{
            position: absolute;
            left:0;
            right:0;
            top:0;
            bottom:0;
            background-color: rgba(36, 144, 255, 0.62);
            z-index: 12;
        }

        #search-bar{
            width: 500px;
            margin: auto;
            padding-top: 30px;
        }

        #search-bar .input-group{
            z-index: 100;
        }
        .stars-icon{
            width: 59px;
            height: 66px;
            background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/star.png);
            background-size: contain;
            background-repeat: no-repeat;
            /* display: inline-block; */
            position: absolute;
            right: -31px;
            top: -20px;
            z-index: 100;
            padding-left: 25px;
            padding-top: 22px;
            color: white;
            display:none;
        }

        @import url(http://fonts.googleapis.com/css?family=Roboto);

        /****** LOGIN MODAL ******/
        .loginmodal-container {
            padding: 30px;
            max-width: 350px;
            width: 100% !important;
            background-color: #F7F7F7;
            margin: 0 auto;
            border-radius: 2px;
            box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            font-family: roboto;
        }

        .loginmodal-container h1 {
            text-align: center;
            font-size: 1.8em;
            font-family: roboto;
        }

        .loginmodal-container input[type=submit] {
            width: 100%;
            display: block;
            margin-bottom: 10px;
            position: relative;
        }

        .loginmodal-container input[type=text], input[type=password] {
            height: 44px;
            font-size: 16px;
            width: 100%;
            margin-bottom: 10px;
            -webkit-appearance: none;
            background: #fff;
            border: 1px solid #d9d9d9;
            border-top: 1px solid #c0c0c0;
            /* border-radius: 2px; */
            padding: 0 8px;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .loginmodal-container input[type=text]:hover, input[type=password]:hover {
            border: 1px solid #b9b9b9;
            border-top: 1px solid #a0a0a0;
            -moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            -webkit-box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
        }

        .loginmodal {
            text-align: center;
            font-size: 14px;
            font-family: 'Arial', sans-serif;
            font-weight: 700;
            height: 36px;
            padding: 0 8px;
            /* border-radius: 3px; */
            /* -webkit-user-select: none;
              user-select: none; */
        }

        .loginmodal-submit {
            /* border: 1px solid #3079ed; */
            border: 0px;
            color: #fff;
            text-shadow: 0 1px rgba(0,0,0,0.1);
            background-color: #4d90fe;
            padding: 17px 0px;
            font-family: roboto;
            font-size: 14px;
            /* background-image: -webkit-gradient(linear, 0 0, 0 100%,   from(#4d90fe), to(#4787ed)); */
        }

        .loginmodal-submit:hover {
            /* border: 1px solid #2f5bb7; */
            border: 0px;
            text-shadow: 0 1px rgba(0,0,0,0.3);
            background-color: #357ae8;
            /* background-image: -webkit-gradient(linear, 0 0, 0 100%,   from(#4d90fe), to(#357ae8)); */
        }

        .loginmodal-container a {
            text-decoration: none;
            color: #666;
            font-weight: 400;
            text-align: center;
            display: inline-block;
            opacity: 0.6;
            transition: opacity ease 0.5s;
        }

        .login-help{
            font-size: 12px;
        }

        #logo {
            color: white;
            position: absolute;
            z-index: 1000;
            font-size: 47px;
            font-weight: bold;
            left: 24px;
            top: 14px;
        }
    </style>
</head>
<body ng-app="justiceApp" ng-controller="justiceController">
<header>
    <div id="screen"></div>
    <div id="collage">
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot2.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot3.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot4.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot5.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot6.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot7.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot8.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot9.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot10.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot11.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot2.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot5.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot6.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot3.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot7.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot11.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot8.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot6.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot9.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot7.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot5.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot2.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot4.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot7.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot11.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot10.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot9.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot8.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot5.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot6.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot4.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot3.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot7.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot2.jpg)"></div>
        <div style="background-image: url(https://s3-us-west-2.amazonaws.com/social-justice/spot1.jpg)"></div>
    </div>
    <div id="logo">LegalGoGo</div>
    <div id="search-bar">
        <div class="input-group">
            <input ng-model="search.keywords" type="text" class="form-control" placeholder="Search for..."/>
            <span class="input-group-btn">
                <button ng-click="getCases()" id="search-cases" class="btn btn-default" type="button">Cases</button>
                <button ng-click="getLawyers()" id="search-lawyers" class="btn btn-default" type="button">Lawyers</button>
            </span>
        </div>
    </div>
</header>
    <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="loginmodal-container">
                <h1>Login to Your Account</h1><br>
                <form>
                    <input id='loginUser' type="text" name="user" placeholder="Username">
                    <input id='loginPassword' type="password" name="pass" placeholder="Password">
                    <input id='loginSubmit' type="submit" name="login" class="login loginmodal-submit" value="Login">
                </form>

                <div class="login-help">
                    <a href="#">Register</a> - <a href="#">Forgot Password</a>
                </div>
            </div>
        </div>
    </div>
    <script>
//        $("#login-modal").modal('hide');
        $('#loginSubmit').click(function(){
            var data = {'username': $('#loginUser').val(),
                        'password': $('#loginPassword').val() };

            var request = $.ajax({
                type: 'POST',
                url: 'http://52.32.221.20:3030/login',
                data: JSON.stringify(data),
                dataType : "json",
                contentType: "application/json; charset=utf-8"
            });

            request.done(function(msg) {
                $("#login-modal").modal('hide');
            });

            request.fail(function(jqXHR, textStatus) {
                $("#login-modal").modal('hide');
            });
        });

    </script>
    <div id="main-results">
        <div ng-repeat="result in cases"  class="case-result result" data-case-id="{{result._source.id}}">
            <div class="stars-icon" style="{{result.starStyle}}">{{result._source.stars}}</div>
            <div class="inner-case-result">
            <img class="case-picture" ng-src="{{result._source.doneeHeadshot}}"/>
            <div class="case-title">{{result._source.storyTitle}}</div>
            <div class="case-donation-info">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="{{result.progress}}" aria-valuemin="0" aria-valuemax="100" style="{{result.progressStyle}}">
                        {{result.progress}} %
                    </div>
                </div>
            </div>
            <div class="case-description">{{result._source.storyDescription}}</div>
            <div>
            <div class="court-info">
                <div class="court-icon"></div>
                <div class="days-left">Court in {{result._source.daysUntilCourtDate}}</div>
                <div class="court-location">{{result._source.courtLocation}}</div>
            </div>
            <div class="case-pledged"><div class="pledged-icon"></div><div class="pledged-amount">$ {{result._source.currentlyPledged}}</div></div>


            <div class="case-views"><span class="views-icon">{{result._source.views}}</span></div>
            </div>
        </div>
        </div>
        <div ng-repeat="result in lawyers"  class="case-result result" data-case-name="{{result._source.name}}">
            <div class="stars-icon" style="{{result.starStyle}}">{{result._source.stars}}</div>
            <div class="inner-case-result">
                <img class="case-picture" ng-src="{{result._source.lawyerPicture}}"/>
                <div class="case-title">{{result._source.name}}</div>
                <div class="case-title">{{result._source.title}}</div>
                <div class="case-description">{{result._source.description}}</div>
                <div>
                    <div class="court-info">
                        <div class="court-icon"></div>
                        <div class="days-left">Years in practice: {{result._source.practiceYears}}</div>
                        <div class="court-location">{{result._source.location}}</div>
                    </div>
                    <div class="case-pledged"><div class="pledged-icon"></div><div class="pledged-amount">$ {{result._source.funds}}</div></div>


                    <div class="case-views"><span class="views-icon">{{result._source.views}}</span></div>
                </div>
            </div>
    </div>
</body>
<script>
    var serviceUrl = "http://52.32.221.20:3030/search/stories";
    var storyUrl = "http://52.32.221.20:3030/search/stories";
    var lawyerUrl = "http://52.32.221.20:3030/search/lawyers";


    var app = angular.module('justiceApp', []);
    app.controller('justiceController', function ($scope,$http) {
        $scope.cases = []
        $scope.lawyers = []
        $scope.search = {keywords: ""}

        $scope.getCases = function () {
            var keywords = angular.toJson($scope.search);
/*
            data = [{
                "_index": "stories",
                "_type": "story",
                "_id": "2",
                "_score": 0.2972674,
                "_source": {
                    "id": 2,
                    "username": "james bond",
                    "doneeHeadshot": "http://images-cdn.moviepilot.com/image/upload/v1426601393/danielcraigasbond-sorry-idris-why-daniel-craig-isn-t-leaving-james-bond-and-shouldn-t-jpeg-209169.jpg",
                    "storyVideo": "https://www.youtube.com/embed/Bpcupsxy0T8",
                    "doneeLocation": "Seattle, WA",
                    "courtDate": "2015-08-04",
                    "courtLocation": "Tacoma, WA",
                    "currentlyPledged": "60",
                    "goal": "100",
                    "storyTitle": "Killed some people.",
                    "storyDescription": "I shot someone",
                    "commentBadges": "1000",
                    "caseUpdates": "0",
                    "donorPicture": "http://i.kinja-img.com/gawker-media/image/upload/s--x6dDPpBh--/184ow2twmecddjpg.jpg",
                    "donorName": "M"
                }
            }];

                data[0].progress = data[0]._source.currentlyPledged / data[0]._source.goal * 100;
                data[0].progressStyle ="width: " + data[0].progress + "%";
                if(data[0]._source.stars)
                    data[0].starStyle="display:block";


            $scope.cases = data;

            */
            $http.post(serviceUrl, angular.toJson($scope.search))
                    .success(function (data) {
                        for(var i = 0; i < data.length;i++) {
                            data[i].progress = data[i]._source.currentlyPledged / data[i]._source.goal * 100;
                            data[i].progressStyle = "width: " + data[i].progress + "%";
                            if(data[0]._source.stars)
                                data[0].starStyle="display:block";
                        }
                        $scope.cases = data;
                    });
            //.error(function(response) { handleFailedRequest(response, "createSiteAlert"); });

        };

        /*
        $scope.getLawyers = function () {

            var data =
            {
                "_index": "lawyers",
                "_type": "lawyer",
                "_id": "bob",
                "_score": 1,
                "_source": {
                    "name": "bob",
                    "password": "123",
                    "stars": 4,
                    "title": "lawyer",
                    "description": "i am a lawyer",
                    "funds": 5000
                }
            }

                $scope.lawyers = data;





            //.error(function(response) { handleFailedRequest(response, "createSiteAlert"); });
        };

        */
        $scope.getLawyers = function () {
            var lawyer = {
                name:$scope.search.keywords
            };

            $http.post(lawyerUrl, angular.toJson(lawyer))
                    .success(function (data) {
                        $scope.lawyers = data;
                    });

        }
    });

    $("#main-results").on("click", ".case-result", function(){
        window.location.href = "http://s3-us-west-2.amazonaws.com/social-justice/story2.html?id=" + $(this).attr("data-case-id");
    });
</script>
</html>